{"version":3,"sources":["login/scripts/login_model.min.js"],"names":["LoginModel","Backbone","Model","extend","cotLogin","modal","checkLogin","_this","this","arguments","length","undefined","serverSide","Promise","resolve","reject","session","isLoggedIn","result","CotSession","LOGIN_CHECK_RESULT_TRUE","logout","requireLogin","options","_this2","then","catch","showLogin","_this3","cot_app","showModal","title","body","loginMessage","footerButtonsHtml","originatingElement","$originatingElement","$","find","className","onShown","click","_login","keydown","e","charCode","keyCode","onHidden","initialize","attributes","_this4","cot_login","onLogin","set"],"mappings":"AAAA,aAKA,IAAIA,WAAaC,SAASC,MAAMC,OAAO,CAIrCC,SAAU,KAEVC,MAAO,KAIPC,WAAY,WACV,IAAIC,EAAQC,KAIZ,OAFiC,EAAnBC,UAAUC,aAA+BC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,IAErEG,WAIN,IAAIC,QAAQ,SAAUC,EAASC,GACpCR,EAAMH,SAASY,QAAQC,WAAW,SAAUC,GACtCA,IAAWC,WAAWC,wBACxBN,IAEAC,QARGP,KAAKJ,SAASa,aAAeJ,QAAQC,UAAYD,QAAQE,UAcpEM,OAAQ,WACNb,KAAKJ,SAASiB,UAEhBC,aAAc,SAAsBC,GAClC,IAAIC,EAAShB,KAEb,OAAOK,QAAQC,UAAUW,KAAK,WAC5B,OAAOD,EAAOlB,WAAWiB,KACxBG,MAAM,WACP,OAAOF,EAAOG,UAAUJ,KACvBG,MAAM,WAEP,OADAF,EAAOH,SACAR,QAAQE,YAGnBY,UAAW,WACT,IAAIC,EAASpB,KAETe,EAA6B,EAAnBd,UAAUC,aAA+BC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,GAMlF,OAJID,KAAKH,OACPG,KAAKH,MAAMA,MAAM,QAGZ,IAAIQ,QAAQ,SAAUC,EAASC,GACpCa,EAAOvB,MAAQwB,QAAQC,UAAU,CAC/BC,MAAO,aACPC,KAAM,eAAiBJ,EAAOL,QAAQU,aAAe,gcACrDC,kBAAmB,iMACnBC,mBAAoBZ,EAAQa,qBAAuBC,EAAET,EAAOxB,SAASmB,QAAyB,iBAAGe,KAAK,WACtGC,UAAW,kBACXC,QAAS,WACPZ,EAAOvB,MAAMiC,KAAK,kBAAkBG,MAAM,WACxCb,EAAOxB,SAASsC,WAElBd,EAAOvB,MAAMiC,KAAK,qBAAqBK,QAAQ,SAAUC,GAChB,MAAlCA,EAAEC,UAAYD,EAAEE,SAAW,IAC9BlB,EAAOxB,SAASsC,YAItBK,SAAU,WACRnB,EAAOtB,WAAWiB,GAASE,KAAK,WAC9BX,KACC,WACDC,YAUViC,WAAY,SAAoBC,EAAY1B,GAC1C,IAAI2B,EAAS1C,KAEbA,KAAKJ,SAAW,IAAI+C,UAAUd,EAAElC,OAAOoB,EAAS,CAC9C6B,QAAS,SAAiBhD,GACxB8C,EAAOG,IAAIjD","file":"login_model.min.js","sourcesContent":["'use strict';\n\n/* global Backbone cot_app cot_login CotSession */\n\n/* exported LoginModel */\nvar LoginModel = Backbone.Model.extend({\n\n  // PROPERTY DEFINITION\n\n  cotLogin: null,\n\n  modal: null,\n\n  // METHOD DEFINITION\n\n  checkLogin: function checkLogin() {\n    var _this = this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (!options.serverSide) {\n      return this.cotLogin.isLoggedIn() ? Promise.resolve() : Promise.reject();\n    }\n\n    return new Promise(function (resolve, reject) {\n      _this.cotLogin.session.isLoggedIn(function (result) {\n        if (result === CotSession.LOGIN_CHECK_RESULT_TRUE) {\n          resolve();\n        } else {\n          reject();\n        }\n      });\n    });\n  },\n\n  logout: function logout() {\n    this.cotLogin.logout();\n  },\n  requireLogin: function requireLogin(options) {\n    var _this2 = this;\n\n    return Promise.resolve().then(function () {\n      return _this2.checkLogin(options);\n    }).catch(function () {\n      return _this2.showLogin(options);\n    }).catch(function () {\n      _this2.logout();\n      return Promise.reject();\n    });\n  },\n  showLogin: function showLogin() {\n    var _this3 = this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (this.modal) {\n      this.modal.modal('hide');\n    }\n\n    return new Promise(function (resolve, reject) {\n      _this3.modal = cot_app.showModal({\n        title: 'User Login',\n        body: '\\n          ' + _this3.options.loginMessage + '\\n          <form>\\n            <div class=\"form-group\">\\n              <label for=\"cot_login_username\">Username</label>:\\n              <input class=\"form-control\" id=\"cot_login_username\">\\n            </div>\\n            <div class=\"form-group\">\\n              <label for=\"cot_login_password\">Password</label>:\\n              <input class=\"form-control\" type=\"password\" id=\"cot_login_password\">\\n            </div>\\n          </form>\\n        ',\n        footerButtonsHtml: '\\n          <button class=\"btn btn-success\" type=\"button\" data-dismiss=\"modal\">Cancel</button>\\n          <button class=\"btn btn-success btn-cot-login\" type=\"button\">Login</button>\\n        ',\n        originatingElement: options.$originatingElement || $(_this3.cotLogin.options['welcomeSelector']).find('a.login'),\n        className: 'cot-login-modal',\n        onShown: function onShown() {\n          _this3.modal.find('.btn-cot-login').click(function () {\n            _this3.cotLogin._login();\n          });\n          _this3.modal.find('.modal-body input').keydown(function (e) {\n            if ((e.charCode || e.keyCode || 0) === 13) {\n              _this3.cotLogin._login();\n            }\n          });\n        },\n        onHidden: function onHidden() {\n          _this3.checkLogin(options).then(function () {\n            resolve();\n          }, function () {\n            reject();\n          });\n        }\n      });\n    });\n  },\n\n\n  // CONSTRUCTOR DEFINITION\n\n  initialize: function initialize(attributes, options) {\n    var _this4 = this;\n\n    this.cotLogin = new cot_login($.extend(options, {\n      onLogin: function onLogin(cotLogin) {\n        _this4.set(cotLogin);\n      }\n    }));\n  }\n});"]}