"use strict";var ODataDataTableView=Backbone.View.extend({columns:null,template:_.template("\n    <table class=\"table table-bordered table-striped\">\n      <thead>\n        <tr>\n        <% for (var i = 0, l = columns.length; i < l; i++) { %>\n          <th><%= columns[i].title || columns[i].data %></th>\n        <% } %>\n        </tr>\n      </thead>\n      <tfoot>\n        <tr>\n        <% for (var i = 0, l = columns.length; i < l; i++) { %>\n          <td data-index=\"<%= i %>\">\n          <% if (_.result(columns[i], 'searchHtml')) { %>\n            <%= _.result(columns[i], 'searchHtml') %>\n          <% } %>\n          </td>\n        <% } %>\n        </tr>\n      </tfoot>\n    </table>\n  "),doColumnSearch:function(t){if(t.preventDefault(),this.dataTable){var e=$(t.currentTarget),a=e.val(),n=+e.closest("td").data("index"),r=this.dataTable.column(n),l="";this.columns[n].searchMap&&(l=this.columns[n].searchMap(a,r,n)||""),l!==r.search()&&(r.search(l),r.draw())}},events:{"change tfoot :input":"doColumnSearch","keyup tfoot :input":"doColumnSearch"},buttonCopy:function(){this.$el.find(".buttons-copy").click()},buttonCsv:function(){this.$el.find(".buttons-csv").click()},buttonExcel:function(){this.$el.find(".buttons-excel").click()},buttonPdf:function(){this.$el.find(".buttons-pdf").click()},buttonPrint:function(){this.$el.find(".buttons-print").click()},reload:function(t,e){this.dataTable&&this.dataTable.ajax.reload(t,e)},remove:function(){this.dataTable&&this.dataTable.destroy(),Backbone.View.prototype.remove.call(this)},render:function(){var i=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t.columns?this.columns=_.result(t,"columns"):t.columns=_.result(this,"columns"),t.collection=this.collection.toJSON(),this.dataTable&&this.dataTable.destroy(),this.$el.html(this.template(t));var e=$.extend({ajax:function(e,t,a){var n={$count:!0},r=e.columns.filter(function(t,e,a){return t.searchable&&t.search&&t.search.value}).map(function(t,e,a){return t.search.value}).join(" and ");r&&(n.$filter=r),n.$orderby=e.order.map(function(t){return e.columns[t.column].data+" "+t.dir}).join(","),e.search&&e.search.value&&(n.$search='"'+e.search.value+'"');var l=a.aoColumns.map(function(t){return t.data}).map(function(t){return $.trim(t)}).filter(function(t,e,a){return a.indexOf(t)===e}).join(",");l&&(n.$select=l),n.$skip=e.start,n.$top=e.length,i.trigger("loadStart"),i.collection.fetch({data:n}).then(function(){i.trigger("loadEnd"),t({data:i.collection.toJSON(),draw:e.draw,recordsTotal:i.collection.count||0,recordsFiltered:i.collection.count||0})})},columns:_.result(this,"columns"),dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'<'table-responsive'tr>>><'row'<'col-sm-5'i><'col-sm-7'p>>B",serverSide:!0},t);return this.dataTable=this.$el.find("table").DataTable(e),Promise.resolve()}},{columnSearchMaps:{dateEquals:function(t,e,a){var n="";return t&&("NULL"===t?n=e.dataSrc()+" eq null":"!NULL"===t?n=e.dataSrc()+" ne null":moment(t,"l").isValid()&&(n=e.dataSrc()+" eq "+moment(t,"l").format())),n},numberEquals:function(t,e,a){var n="";return t&&("NULL"===t?n=e.dataSrc()+" eq null":"!NULL"===t?n=e.dataSrc()+" ne null":isNaN(t)&&(n=e.dataSrc()+" eq "+t)),n},numberExpression:function(t,e,a){var n="";if(t=$.trim(t))if(0===t.indexOf("!="))(t=$.trim(t.replace("!=","")))&&("NULL"===t?n=e.dataSrc()+" ne null":"!NULL"===t?n=e.dataSrc()+" eq null":isNaN(t)||(n=e.dataSrc()+" ne "+t));else if(0===t.indexOf(">="))(t=$.trim(t.replace(">=","")))&&!isNaN(t)&&(n=e.dataSrc()+" ge "+t);else if(0===t.indexOf(">"))(t=$.trim(t.replace(">","")))&&!isNaN(t)&&(n=e.dataSrc()+" gt "+t);else if(0===t.indexOf("<="))(t=$.trim(t.replace("<=","")))&&!isNaN(t)&&(n=e.dataSrc()+" le "+t);else if(0===t.indexOf("<"))(t=$.trim(t.replace("<","")))&&!isNaN(t)&&(n=e.dataSrc()+" lt "+t);else if(-1!==t.indexOf("-")||-1!==t.toLowerCase().indexOf("to")){var r=(t=t.replace(/to/gi,"-")).split("-").map(function(t){return $.trim(t)});r[0]&&!isNaN(r[0])&&(n=e.dataSrc()+" ge "+r[0],r[1]&&!isNaN(r[1])&&+r[1]>=+r[0]&&(n=n+" and "+e.dataSrc()+" le "+r[1]))}else 0===t.indexOf("=")&&(t=$.trim(t.replace("=",""))),t&&("NULL"===t?n=e.dataSrc()+" eq null":"!NULL"===t?n=e.dataSrc()+" ne null":isNaN(t)||(n=e.dataSrc()+" eq "+t));return n},stringContains:function(t,e,a){var n="";return t&&(n="NULL"===t?e.dataSrc()+" eq null":"!NULL"===t?e.dataSrc()+" ne null":"contains(tolower("+e.dataSrc()+"),'"+t.toLowerCase()+"')"),n},stringEquals:function(t,e,a){var n="";return t&&(n="NULL"===t?e.dataSrc()+" eq null":"!NULL"===t?e.dataSrc()+" ne null":"tolower("+e.dataSrc()+") eq '"+t.toLowerCase()+"'"),n}}});
//# sourceMappingURL=odata_datatable_view.min.js.map
