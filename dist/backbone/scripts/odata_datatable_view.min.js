"use strict";var ODataDataTableView=Backbone.View.extend({columns:null,template:_.template("\n    <table class=\"table table-bordered table-striped\">\n      <thead>\n        <tr>\n        <% for (var i = 0, l = columns.length; i < l; i++) { %>\n          <th><%= columns[i].title || columns[i].data %></th>\n        <% } %>\n        </tr>\n      </thead>\n      <tfoot>\n        <tr>\n        <% for (var i = 0, l = columns.length; i < l; i++) { %>\n          <td data-index=\"<%= i %>\">\n          <% if (_.result(columns[i], 'searchHtml')) { %>\n            <%= _.result(columns[i], 'searchHtml') %>\n          <% } %>\n          </td>\n        <% } %>\n        </tr>\n      </tfoot>\n    </table>\n  "),doColumnSearch:function(t){if(t.preventDefault(),this.dataTable){var e=$(t.currentTarget),n=e.val(),a=+e.closest("td").data("index"),l=this.dataTable.column(a),o="";this.columns[a].searchMap&&(o=this.columns[a].searchMap(n,l,a)||""),o!==l.search()&&(l.search(o),l.draw())}},events:{"change tfoot :input":"doColumnSearch","keyup tfoot :input":"doColumnSearch"},buttonCopy:function(){this.$el.find(".buttons-copy").click()},buttonCsv:function(){this.$el.find(".buttons-csv").click()},buttonExcel:function(){this.$el.find(".buttons-excel").click()},buttonPdf:function(){this.$el.find(".buttons-pdf").click()},buttonPrint:function(){this.$el.find(".buttons-print").click()},reload:function(t,e){this.dataTable&&this.dataTable.ajax.reload(t,e)},remove:function(){this.dataTable&&this.dataTable.destroy(),Backbone.View.prototype.remove.call(this)},render:function(){var r=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return console.log("ODATA DATATABLE VIEW RENDER"),t.columns?this.columns=_.result(t,"columns"):t.columns=_.result(this,"columns"),console.log("OPTIONS COLUMNS",t.columns),t.collection=this.collection.toJSON(),this.dataTable&&this.dataTable.destroy(),this.$el.html(this.template(t)),console.log("$EL",this.$el),console.log("COLUMNS",_.result(this,"columns")),this.dataTable=this.$el.find("table").DataTable({ajax:function(e,t,n){var a={$count:!0};console.log("FETCH DATA",a);var l=e.columns.filter(function(t,e,n){return t.searchable&&t.search&&t.search.value}).map(function(t,e,n){return t.search.value}).join(" and ");l&&(a.$filter=l),console.log("FETCH DATA",a),a.$orderby=e.order.map(function(t){return e.columns[t.column].data+" "+t.dir}).join(","),console.log("FETCH DATA",a),e.search&&e.search.value&&(a.$search='"'+e.search.value+'"'),console.log("FETCH DATA",a);var o=n.aoColumns.map(function(t){return t.data}).map(function(t){return $.trim(t)}).filter(function(t,e,n){return n.indexOf(t)===e}).join(",");o&&(a.$select=o),console.log("FETCH DATA",a),a.$skip=e.start,a.$top=e.length,console.log("FETCH DATA",a),r.trigger("loadStart"),r.collection.fetch({data:a}).then(function(){r.trigger("loadEnd"),t({data:r.collection.toJSON(),draw:e.draw,recordsTotal:r.collection.count||0,recordsFiltered:r.collection.count||0})})},columns:_.result(this,"columns"),dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'<'table-responsive'tr>>><'row'<'col-sm-5'i><'col-sm-7'p>>B",order:t.order||null,serverSide:!0}),Promise.resolve()}},{columnSearchMaps:{dateEquals:function(t,e,n){var a="";return t&&("NULL"===t?a=e.dataSrc()+" eq null":"!NULL"===t?a=e.dataSrc()+" ne null":moment(t,"l").isValid()&&(a=e.dataSrc()+" eq "+moment(t,"l").format())),a},numberEquals:function(t,e,n){var a="";return t&&("NULL"===t?a=e.dataSrc()+" eq null":"!NULL"===t?a=e.dataSrc()+" ne null":isNaN(t)&&(a=e.dataSrc()+" eq "+t)),a},numberExpression:function(t,e,n){var a="";if(t=$.trim(t))if(0===t.indexOf("!="))(t=$.trim(t.replace("!=","")))&&("NULL"===t?a=e.dataSrc()+" ne null":"!NULL"===t?a=e.dataSrc()+" eq null":isNaN(t)||(a=e.dataSrc()+" ne "+t));else if(0===t.indexOf(">="))(t=$.trim(t.replace(">=","")))&&!isNaN(t)&&(a=e.dataSrc()+" ge "+t);else if(0===t.indexOf(">"))(t=$.trim(t.replace(">","")))&&!isNaN(t)&&(a=e.dataSrc()+" gt "+t);else if(0===t.indexOf("<="))(t=$.trim(t.replace("<=","")))&&!isNaN(t)&&(a=e.dataSrc()+" le "+t);else if(0===t.indexOf("<"))(t=$.trim(t.replace("<","")))&&!isNaN(t)&&(a=e.dataSrc()+" lt "+t);else if(-1!==t.indexOf("-")||-1!==t.toLowerCase().indexOf("to")){var l=(t=t.replace(/to/gi,"-")).split("-").map(function(t){return $.trim(t)});l[0]&&!isNaN(l[0])&&(a=e.dataSrc()+" ge "+l[0],l[1]&&!isNaN(l[1])&&+l[1]>=+l[0]&&(a=a+" and "+e.dataSrc()+" le "+l[1]))}else 0===t.indexOf("=")&&(t=$.trim(t.replace("=",""))),t&&("NULL"===t?a=e.dataSrc()+" eq null":"!NULL"===t?a=e.dataSrc()+" ne null":isNaN(t)||(a=e.dataSrc()+" eq "+t));return a},stringContains:function(t,e,n){var a="";return t&&(a="NULL"===t?e.dataSrc()+" eq null":"!NULL"===t?e.dataSrc()+" ne null":"contains(tolower("+e.dataSrc()+"),'"+t.toLowerCase()+"')"),a},stringEquals:function(t,e,n){var a="";return t&&(a="NULL"===t?e.dataSrc()+" eq null":"!NULL"===t?e.dataSrc()+" ne null":"tolower("+e.dataSrc()+") eq '"+t.toLowerCase()+"'"),a}}});
//# sourceMappingURL=odata_datatable_view.min.js.map
