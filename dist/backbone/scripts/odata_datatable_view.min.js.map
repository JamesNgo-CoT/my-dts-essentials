{"version":3,"sources":["backbone/scripts/odata_datatable_view.min.js"],"names":["ODataDataTableView","Backbone","View","extend","columns","template","_","doColumnSearch","e","preventDefault","this","dataTable","$input","$","currentTarget","value","val","index","closest","data","dataTableColumn","column","searchString","searchMap","search","draw","events","change tfoot :input","keyup tfoot :input","buttonCopy","$el","find","click","buttonCsv","buttonExcel","buttonPdf","buttonPrint","reload","callback","resetPaging","ajax","remove","destroy","prototype","call","render","_this","options","arguments","length","undefined","result","collection","toJSON","html","DataTable","settings","fetchData","$count","$filter","filter","array","searchable","map","join","$orderby","order","dir","$search","$select","aoColumns","trim","indexOf","$skip","start","$top","trigger","fetch","then","recordsTotal","count","recordsFiltered","dom","serverSide","Promise","resolve","columnSearchMap","dateEquals","dataSrc","moment","isValid","format","numberEquals","isNaN","numberExpression","replace","toLowerCase","values","split","stringContains","stringEquals"],"mappings":"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","file":"odata_datatable_view.min.js","sourcesContent":["'use strict';\n\n/* global _ Backbone moment */\n\n/* exported ODataDataTableView */\nvar ODataDataTableView = Backbone.View.extend({\n\n  // PROPERTY DEFINITION\n\n  columns: null,\n\n  template: _.template('\\n    <table class=\"table table-bordered table-striped\">\\n      <thead>\\n        <tr>\\n        <% for (var i = 0, l = columns.length; i < l; i++) { %>\\n          <th><%= columns[i].title || columns[i].data %></th>\\n        <% } %>\\n        </tr>\\n      </thead>\\n      <tfoot>\\n        <tr>\\n        <% for (var i = 0, l = columns.length; i < l; i++) { %>\\n          <td data-index=\"<%= i %>\">\\n          <% if (_.result(columns[i], \\'searchHtml\\')) { %>\\n            <%= _.result(columns[i], \\'searchHtml\\') %>\\n          <% } %>\\n          </td>\\n        <% } %>\\n        </tr>\\n      </tfoot>\\n    </table>\\n  '),\n\n  // EVENT HANDLER DEFINITION\n\n  doColumnSearch: function doColumnSearch(e) {\n    e.preventDefault();\n\n    if (this.dataTable) {\n      var $input = $(e.currentTarget);\n      var value = $input.val();\n      var index = +$input.closest('td').data('index');\n      var dataTableColumn = this.dataTable.column(index);\n\n      var searchString = '';\n\n      if (this.columns[index].searchMap) {\n        searchString = this.columns[index].searchMap(value, dataTableColumn, index) || '';\n      }\n\n      if (searchString !== dataTableColumn.search()) {\n        dataTableColumn.search(searchString);\n        dataTableColumn.draw();\n      }\n    }\n  },\n\n  events: {\n    'change tfoot :input': 'doColumnSearch',\n    'keyup tfoot :input': 'doColumnSearch'\n  },\n\n  // METHOD DEFINITION\n\n  buttonCopy: function buttonCopy() {\n    this.$el.find('.buttons-copy').click();\n  },\n\n  buttonCsv: function buttonCsv() {\n    this.$el.find('.buttons-csv').click();\n  },\n\n  buttonExcel: function buttonExcel() {\n    this.$el.find('.buttons-excel').click();\n  },\n\n  buttonPdf: function buttonPdf() {\n    this.$el.find('.buttons-pdf').click();\n  },\n\n  buttonPrint: function buttonPrint() {\n    this.$el.find('.buttons-print').click();\n  },\n\n  reload: function reload(callback, resetPaging) {\n    if (this.dataTable) {\n      this.dataTable.ajax.reload(callback, resetPaging);\n    }\n  },\n\n  remove: function remove() {\n    if (this.dataTable) {\n      this.dataTable.destroy();\n    }\n\n    Backbone.View.prototype.remove.call(this);\n  },\n\n  render: function render() {\n    var _this = this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (options.columns) {\n      this.columns = _.result(options, 'columns');\n    } else {\n      options.columns = _.result('this', 'columns');\n    }\n\n    options.collection = this.collection.toJSON();\n\n    if (this.dataTable) {\n      this.dataTable.destroy();\n    }\n\n    this.$el.html(this.template(options));\n\n    this.dataTable = this.$el.find('table').DataTable({\n      ajax: function ajax(data, callback, settings) {\n        var fetchData = {};\n\n        // $count\n        fetchData.$count = true;\n\n        // $filter\n        var $filter = data.columns.filter(function (value, index, array) {\n          return value.searchable && value.search && value.search.value;\n        }).map(function (value, index, array) {\n          return value.search.value;\n        }).join(' and ');\n        if ($filter) {\n          fetchData.$filter = $filter;\n        }\n\n        // $orderby\n        fetchData.$orderby = data.order.map(function (value) {\n          return data.columns[value.column].data + ' ' + value.dir;\n        }).join(',');\n\n        // $search\n        if (data.search && data.search.value) {\n          fetchData.$search = '\"' + data.search.value + '\"';\n        }\n\n        // $select\n        var $select = settings.aoColumns.map(function (value) {\n          return value.data;\n        }).map(function (value) {\n          return $.trim(value);\n        }).filter(function (value, index, array) {\n          return array.indexOf(value) === index;\n        }).join(',');\n        if ($select) {\n          fetchData.$select = $select;\n        }\n\n        // $skip\n        fetchData.$skip = data.start;\n\n        // $top\n        fetchData.$top = data.length;\n\n        _this.trigger('loadStart');\n        _this.collection.fetch({ data: fetchData }).then(function () {\n          _this.trigger('loadEnd');\n          callback({\n            data: _this.collection.toJSON(),\n            draw: data.draw,\n            recordsTotal: _this.collection.count || 0,\n            recordsFiltered: _this.collection.count || 0\n          });\n        });\n      },\n      columns: _.result(this, 'columns'),\n      dom: '<\\'row\\'<\\'col-sm-6\\'l><\\'col-sm-6\\'f>><\\'row\\'<\\'col-sm-12\\'<\\'table-responsive\\'tr>>><\\'row\\'<\\'col-sm-5\\'i><\\'col-sm-7\\'p>>B',\n      serverSide: true\n    });\n\n    return Promise.resolve();\n  }\n}, {\n  columnSearchMap: {\n    dateEquals: function dateEquals(value, dataTableColumn, index) {\n      var searchString = '';\n      if (value) {\n        if (value === 'NULL') {\n          searchString = dataTableColumn.dataSrc() + ' eq null';\n        } else if (value === '!NULL') {\n          searchString = dataTableColumn.dataSrc() + ' ne null';\n        } else if (moment(value, 'l').isValid()) {\n          searchString = dataTableColumn.dataSrc() + ' eq ' + moment(value, 'l').format();\n        }\n      }\n      return searchString;\n    },\n\n    numberEquals: function numberEquals(value, dataTableColumn, index) {\n      var searchString = '';\n      if (value) {\n        if (value === 'NULL') {\n          searchString = dataTableColumn.dataSrc() + ' eq null';\n        } else if (value === '!NULL') {\n          searchString = dataTableColumn.dataSrc() + ' ne null';\n        } else if (isNaN(value)) {\n          searchString = dataTableColumn.dataSrc() + ' eq ' + value;\n        }\n      }\n      return searchString;\n    },\n\n    numberExpression: function numberExpression(value, dataTableColumn, index) {\n      var searchString = '';\n      value = $.trim(value);\n      if (value) {\n        if (value.indexOf('!=') === 0) {\n          value = $.trim(value.replace('!=', ''));\n          if (value) {\n            if (value === 'NULL') {\n              searchString = dataTableColumn.dataSrc() + ' ne null';\n            } else if (value === '!NULL') {\n              searchString = dataTableColumn.dataSrc() + ' eq null';\n            } else if (!isNaN(value)) {\n              searchString = dataTableColumn.dataSrc() + ' ne ' + value;\n            }\n          }\n        } else if (value.indexOf('>=') === 0) {\n          value = $.trim(value.replace('>=', ''));\n          if (value && !isNaN(value)) {\n            searchString = dataTableColumn.dataSrc() + ' ge ' + value;\n          }\n        } else if (value.indexOf('>') === 0) {\n          value = $.trim(value.replace('>', ''));\n          if (value && !isNaN(value)) {\n            searchString = dataTableColumn.dataSrc() + ' gt ' + value;\n          }\n        } else if (value.indexOf('<=') === 0) {\n          value = $.trim(value.replace('<=', ''));\n          if (value && !isNaN(value)) {\n            searchString = dataTableColumn.dataSrc() + ' le ' + value;\n          }\n        } else if (value.indexOf('<') === 0) {\n          value = $.trim(value.replace('<', ''));\n          if (value && !isNaN(value)) {\n            searchString = dataTableColumn.dataSrc() + ' lt ' + value;\n          }\n        } else if (value.indexOf('-') !== -1 || value.toLowerCase().indexOf('to') !== -1) {\n          value = value.replace(/to/ig, '-');\n          var values = value.split('-').map(function (value) {\n            return $.trim(value);\n          });\n          if (values[0] && !isNaN(values[0])) {\n            searchString = dataTableColumn.dataSrc() + ' ge ' + values[0];\n            if (values[1] && !isNaN(values[1]) && +values[1] >= +values[0]) {\n              searchString = searchString + ' and ' + dataTableColumn.dataSrc() + ' le ' + values[1];\n            }\n          }\n        } else {\n          if (value.indexOf('=') === 0) {\n            value = $.trim(value.replace('=', ''));\n          }\n          if (value) {\n            if (value === 'NULL') {\n              searchString = dataTableColumn.dataSrc() + ' eq null';\n            } else if (value === '!NULL') {\n              searchString = dataTableColumn.dataSrc() + ' ne null';\n            } else if (!isNaN(value)) {\n              searchString = dataTableColumn.dataSrc() + ' eq ' + value;\n            }\n          }\n        }\n      }\n      return searchString;\n    },\n\n    stringContains: function stringContains(value, dataTableColumn, index) {\n      var searchString = '';\n      if (value) {\n        if (value === 'NULL') {\n          searchString = dataTableColumn.dataSrc() + ' eq null';\n        } else if (value === '!NULL') {\n          searchString = dataTableColumn.dataSrc() + ' ne null';\n        } else {\n          searchString = 'contains(tolower(' + dataTableColumn.dataSrc() + '),\\'' + value.toLowerCase() + '\\')';\n        }\n      }\n      return searchString;\n    },\n\n    stringEquals: function stringEquals(value, dataTableColumn, index) {\n      var searchString = '';\n      if (value) {\n        if (value === 'NULL') {\n          searchString = dataTableColumn.dataSrc() + ' eq null';\n        } else if (value === '!NULL') {\n          searchString = dataTableColumn.dataSrc() + ' ne null';\n        } else {\n          searchString = 'tolower(' + dataTableColumn.dataSrc() + ') eq \\'' + value.toLowerCase() + '\\'';\n        }\n      }\n      return searchString;\n    }\n  }\n});"]}